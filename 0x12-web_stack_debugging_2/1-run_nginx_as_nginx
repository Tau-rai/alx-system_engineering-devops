#!/usr/bin/env bash
# This script configures a container to run nginx as ngix user
# and listens to all active IPs on port 8080

# Variables
NGINX_CONF="/etc/nginx/nginx.conf"
NGINX_USER="nginx"
NGINX_GROUP="nginx"
NGINX_PORT="8080"

# Change the user and group in the Nginx configuration
sudo sed -i "s/user\s*[^;]*;/user $NGINX_USER $NGINX_GROUP;/g" "$NGINX_CONF"

# Modify Nginx configuration to listen on all IPs on port 8080
sudo sed -i "s/listen\s*[^;]*;/listen $NGINX_PORT;/g" "$NGINX_CONF"

# Restart Nginx to apply the changes
sudo service nginx restart

echo "Nginx has been successfully configured and restarted"